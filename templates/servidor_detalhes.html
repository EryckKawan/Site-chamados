{% extends 'base.html' %}

{% block title %}Detalhes do Servidor{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="bi bi-server"></i> {{ servidor.nome }}
        </h1>
        <div>
            {% if session.role in ['admin', 'tech'] %}
            <a href="{{ url_for('servidor.editar', id=servidor.id) }}" class="btn btn-warning me-2">
                <i class="bi bi-pencil"></i> Editar
            </a>
            {% endif %}
            <a href="{{ url_for('servidor.listar') }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Voltar
            </a>
        </div>
    </div>

    {% include 'includes/flash_messages.html' %}

    <div class="row">
        <!-- Informações do Servidor -->
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="bi bi-info-circle"></i> Informações do Servidor
                    </h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-borderless">
                            <tr>
                                <td width="30%"><strong>Nome:</strong></td>
                                <td>{{ servidor.nome }}</td>
                            </tr>
                            <tr>
                                <td><strong>Endereço IP:</strong></td>
                                <td>{{ servidor.ip }}</td>
                            </tr>
                            <tr>
                                <td><strong>Localização:</strong></td>
                                <td>{{ servidor.localizacao }}</td>
                            </tr>
                            <tr>
                                <td><strong>Data de Cadastro:</strong></td>
                                <td>{{ servidor.created_at|format_date('%d/%m/%Y %H:%M') }}</td>
                            </tr>
                            <tr>
                                <td><strong>Última Atualização:</strong></td>
                                <td>{{ servidor.updated_at|format_date('%d/%m/%Y %H:%M') }}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
                
            {% if servidor.observacoes %}
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="bi bi-file-text"></i> Observações
                    </h6>
                </div>
                <div class="card-body">
                    <div class="bg-light p-3 rounded">
                        {{ servidor.observacoes | replace('\n', '<br>') | safe }}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Estatísticas de Armazenamento -->
        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="bi bi-hdd-stack"></i> Armazenamento
                    </h6>
                </div>
                <div class="card-body">
                    <div class="text-center mb-4">
                        <h4>{{ servidor.espaco_total }} {{ servidor.unidade }}</h4>
                        <p class="text-muted mb-2">Capacidade Total</p>
                        <div class="btn-group btn-group-sm mt-2" role="group">
                            <button type="button" class="btn {% if servidor.unidade == 'MB' %}btn-primary{% else %}btn-outline-secondary{% endif %}">
                                <small>MB</small><br>{{ "%.2f"|format(servidor.espaco_total_em('MB')) }}
                            </button>
                            <button type="button" class="btn {% if servidor.unidade == 'GB' %}btn-primary{% else %}btn-outline-secondary{% endif %}">
                                <small>GB</small><br>{{ "%.2f"|format(servidor.espaco_total_em('GB')) }}
                            </button>
                            <button type="button" class="btn {% if servidor.unidade == 'TB' %}btn-primary{% else %}btn-outline-secondary{% endif %}">
                                <small>TB</small><br>{{ "%.2f"|format(servidor.espaco_total_em('TB')) }}
                            </button>
                        </div>
                    </div>
                    
                    {% set espaco_livre = servidor.espaco_total - servidor.espaco_usado %}
                    {% set porcentagem_livre = (espaco_livre / servidor.espaco_total * 100) if servidor.espaco_total > 0 else 0 %}
                    {% set porcentagem_livre = porcentagem_livre|round(2) %}
                    {% set porcentagem_usado = 100 - porcentagem_livre %}
                    
                    <div class="mb-4">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Espaço Utilizado</span>
                            <span>{{ porcentagem_usado|round(2) }}%</span>
                        </div>
                        <div class="progress">
                            {% if porcentagem_usado < 50 %}
                                {% set cor = "success" %}
                            {% elif porcentagem_usado < 80 %}
                                {% set cor = "warning" %}
                            {% else %}
                                {% set cor = "danger" %}
                            {% endif %}
                            
                            <div class="progress-bar bg-{{ cor }}" role="progressbar" 
                                 style="width: {{ porcentagem_usado }}%" 
                                 aria-valuenow="{{ porcentagem_usado }}" 
                                 aria-valuemin="0" 
                                 aria-valuemax="100">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row text-center">
                        <div class="col-6 border-end">
                            <h5>{{ servidor.espaco_usado }} {{ servidor.unidade }}</h5>
                            <small class="text-muted">Usado</small>
                            <div class="d-flex gap-1 justify-content-center mt-2">
                                <button type="button" class="btn btn-sm {% if servidor.unidade == 'MB' %}btn-warning{% else %}btn-outline-warning{% endif %}" title="Espaço usado em MB">
                                    <small>MB</small><br><strong>{{ "%.1f"|format(servidor.espaco_usado_em('MB')) }}</strong>
                                </button>
                                <button type="button" class="btn btn-sm {% if servidor.unidade == 'GB' %}btn-warning{% else %}btn-outline-warning{% endif %}" title="Espaço usado em GB">
                                    <small>GB</small><br><strong>{{ "%.1f"|format(servidor.espaco_usado_em('GB')) }}</strong>
                                </button>
                                <button type="button" class="btn btn-sm {% if servidor.unidade == 'TB' %}btn-warning{% else %}btn-outline-warning{% endif %}" title="Espaço usado em TB">
                                    <small>TB</small><br><strong>{{ "%.2f"|format(servidor.espaco_usado_em('TB')) }}</strong>
                                </button>
                            </div>
                        </div>
                        <div class="col-6">
                            <h5>{{ espaco_livre|round(2) }} {{ servidor.unidade }}</h5>
                            <small class="text-muted">Livre</small>
                            <div class="d-flex gap-1 justify-content-center mt-2">
                                <button type="button" class="btn btn-sm {% if servidor.unidade == 'MB' %}btn-success{% else %}btn-outline-success{% endif %}" title="Espaço livre em MB">
                                    <small>MB</small><br><strong>{{ "%.1f"|format(servidor.espaco_livre_em('MB')) }}</strong>
                                </button>
                                <button type="button" class="btn btn-sm {% if servidor.unidade == 'GB' %}btn-success{% else %}btn-outline-success{% endif %}" title="Espaço livre em GB">
                                    <small>GB</small><br><strong>{{ "%.1f"|format(servidor.espaco_livre_em('GB')) }}</strong>
                                </button>
                                <button type="button" class="btn btn-sm {% if servidor.unidade == 'TB' %}btn-success{% else %}btn-outline-success{% endif %}" title="Espaço livre em TB">
                                    <small>TB</small><br><strong>{{ "%.2f"|format(servidor.espaco_livre_em('TB')) }}</strong>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="alert {{ 'alert-success' if porcentagem_livre > 50 else 'alert-warning' if porcentagem_livre > 20 else 'alert-danger' }}">
                        <i class="bi {{ 'bi-check-circle' if porcentagem_livre > 50 else 'bi-exclamation-triangle' }}"></i>
                        {% if porcentagem_livre > 50 %}
                            Espaço em disco suficiente
                        {% elif porcentagem_livre > 20 %}
                            Espaço em disco limitado
                        {% else %}
                            Espaço em disco crítico
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}